dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID))
check <- subset(Duplicates_file, Metabolite=="Amide_Glucose.Fructose.Galactose_waterloss")
check <- subset(Duplicates_file, HMDB_ID=="HMDB0000148",)
View(check)
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID)) |>
dplyr::mutate(Metabolite, dplyr::case_when(Metabolite=="Amide_Glucose.Fructose.Galactose_waterloss" ~ "Hexose",
TRUE ~ Metabolite))
check <- subset(Duplicates_file, Metabolite=="Hexose")
check <- subset(Mapping_file, Metabolite=="Hexose")
check <- subset(Mapping_file, HMDB_ID=="HMDB0000122")
View(check)
View(check)
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID)) |>
dplyr::mutate(Metabolite, dplyr::case_when(Original_Metabolite_Name=="Glucose/Fructose/Galactose_waterloss" ~ "Amide_Hexose",
TRUE ~ Metabolite))
check <- subset(Mapping_file, Metabolite=="Hexose")
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID)) |>
dplyr::mutate(Metabolite = dplyr::case_when(Original_Metabolite_Name=="Glucose/Fructose/Galactose_waterloss" ~ "Amide_Hexose",
TRUE ~ Metabolite))
check <- subset(Mapping_file, Metabolite=="Hexose")
check <- subset(Mapping_file, Original_Metabolite_Name=="Glucose/Fructose/Galactose_waterloss")
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID))
Duplicates_file <- Duplicates_file |>
dplyr::mutate(Metabolite = dplyr::case_when(Original_Metabolite_Name=="Glucose/Fructose/Galactose_waterloss" ~ "Amide_Hexose",
TRUE ~ Metabolite))
check <- subset(Mapping_file, Original_Metabolite_Name=="Glucose/Fructose/Galactose_waterloss")
check <- subset(Mapping_file, Metabolite=="Hexose")
check <- subset(Duplicates_file, Metabolite=="Hexose")
View(Mapping_file)
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID))
check <- subset(Duplicates_file, HMDB_ID=="HMDB0000122")
View(check)
Duplicates_file <- Duplicates_file |>
dplyr::mutate(Metabolite = dplyr::case_when(Assay=="Amide" & HMDB_ID=="HMDB0000122" ~ "Amide_Hexose",
TRUE ~ Metabolite))
check <- subset(Duplicates_file, Metabolite=="Amide_Hexose")
View(check)
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID)) |>
dplyr::mutate(Metabolite = dplyr::case_when(Assay=="Amide" & HMDB_ID=="HMDB0000122" ~ "Amide_Hexose",
TRUE ~ Metabolite)) |>
dplyr::mutate(Cleaned_Metabolite_Name = dplyr::case_when(Assay=="Amide" & HMDB_ID=="HMDB0000122" ~ "Hexose",
TRUE ~ Original_Metabolite_Name))
check <- subset(Duplicates_file, Cleaned_Metabolite_Name=="Hexose")
View(check)
write.csv(Duplicates_file, "/media/Analyses/Make-MESA-TOPMed-Metabolite-Table/script-building/Duplicates.csv", row.names=FALSE)
test <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 1️⃣ Flag same HMDB_ID but different names
Duplicate_flag = if_else(
n() > 1 & n_distinct(Cleaned_Metabolite_Name) > 1,
TRUE,
FALSE
))
View(test)
test <- suset(test, Duplicate_flag=="TRUE")
test <- subset(test, Duplicate_flag=="TRUE")
View(test)
test <- test[order(test$HMDB_ID),]
View(test)
#write.csv(test, "/media/Analyses/Make-MESA-TOPMed-Metabolite-Table/script-building/Duplicate_changes.csv", row.names=FALSE)
write.csv(test, "/media/Analyses/Make-MESA-TOPMed-Metabolite-Table/script-building/Duplicate_changes.csv", row.names=FALSE)
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2                                               # not the lowest
)
) %>%
ungroup()
View(test)
View(temp)
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
ungroup() |>
mutate(
Retain = case_when(is.na(HMDB) ~ 0
# lowest CV among duplicates
TRUE ~ Retain
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
ungroup() |>
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0
# lowest CV among duplicates
TRUE ~ Retain
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
ungroup() |>
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0,
# lowest CV among duplicates
TRUE ~ Retain
)
) %>%
ungroup()
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
ungroup() |>
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0,
# lowest CV among duplicates
TRUE ~ Retain
)
)
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
ungroup()
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(
n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 1️⃣ Flag TRUE if same HMDB_ID has multiple distinct Cleaned_Metabolite_Name
Duplicate_flag = if_else(
n() > 1 & n_distinct(Cleaned_Metabolite_Name) > 1,
TRUE, FALSE
),
# 2️⃣ Compute Retain with NA-safe min()
Retain = case_when(
n() == 1 ~ 0,
all(is.na(cv_percent)) ~ NA_real_,  # handle all-NA case
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,
TRUE ~ 2
)
) %>%
ungroup()
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(!is.na(HMDB_ID) & is.na(cv_percent) & n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )                                             # not the lowest) |>
ungroup()
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
# 2️⃣ Assign retain values
Retain = case_when(!is.na(HMDB_ID) & is.na(cv_percent) & n() == 1 ~ 0,                                         # unique HMDB_ID
cv_percent == min(cv_percent, na.rm = TRUE) ~ 1,       # lowest CV among duplicates
TRUE ~ 2 ) )
check <- subset(Duplicates_file, HMDB_ID = "HMDB0000119")
View(check)
check2 <- subset(Duplicates_file, HMDB_ID = "HMDB0000119")
View(check2)
check2 <- Duplicates_file[Duplicates_file$HMDB_ID = "HMDB0000119",]
check2 <- Duplicates_file[Duplicates_file$HMDB_ID == "HMDB0000119",]
View(check2)
check2 <- Mapping_file[Mapping_file$HMDB_ID == "HMDB0000119",]
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
Retain = case_when(!is.na(HMDB_ID) & is.na(cv_percent) & n() == 1 ~ 0,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )
View(temp)
##Build-up
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
Retain = case_when(!is.na(HMDB_ID) & is.na(cv_percent) & n() == 1 ~ 0,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
View(temp)
check <- subset(temp, Retail==0)
check <- subset(temp, Retain==0)
View(check)
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0
n() == 1 ~ 0,                                         # unique HMDB_ID      # lowest CV among duplicates
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0,
n() == 1 ~ 0,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
check <- subset(temp, Retain==0)
View(check)
View(temp)
table(temp$Retain)
temp <- Duplicates_file %>%
group_by(HMDB_ID) %>%
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0,
n() == 1 ~ 1,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
table(temp$Retain)
##Build-up
temp <- Duplicates_file |>
mutate(
Retain = case_when(is.na(HMDB_ID) ~ 0,
(group_by(HMDB_ID) |>
n() == 1 ~ 1),                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
temp <- Duplicates_file |>
group_by(HMDB_ID) |>
mutate(dplyr::case_when(n() == 1 ~ 1,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
temp <- Duplicates_file |>
group_by(HMDB_ID) |>
mutate(Retain = dplyr::case_when(n() == 1 ~ 1,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
table(temp$Retain)
check <- subset(temp, !is.na(HMDB) & Retain==2)
check <- subset(temp, !is.na(HMDB_ID) & Retain==2)
View(check)
check <- check[order(check$HMDB_ID),]
View(check)
check$HMDB_ID
check <- subset(temp, !is.na(HMDB_ID) & HMDB_ID !="" & Retain==2)
check <- check[order(check$HMDB_ID),]
View(check)
temp <- Duplicates_file |>
group_by(HMDB_ID) |>
mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 1,
n() == 1 ~ 1,                                         # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
check <- subset(temp, Retain==2)
check <- check[order(check$HMDB_ID),]
View(check)
temp <- Duplicates_file |>
group_by(HMDB_ID) |>
mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent== min(cv_percent, na.rm = TRUE) ~ 1,  # unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 2 ) )  |>
ungroup()
check <- subset(temp, Retain!=0)
check <- check[order(check$HMDB_ID),]
View(check)
View(check)
temp <- Duplicates_file |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent== min(cv_percent, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard", 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::mutate(Retain, factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV")))
temp <- Duplicates_file |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent== min(cv_percent, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::mutate(Retain, factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV")))
temp <- Duplicates_file |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent== min(cv_percent, na.rm = TRUE) ~ 1,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::ungroup()
table(temp$Retain)
check <- subset(temp, Retain!=0)
check <- check[order(check$HMDB_ID),]
View(check)
temp <- Duplicates_file |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
is.na(cv_percent) ~ 3
cv_percent== min(cv_percent, na.rm = TRUE) ~ 1,
temp <- Duplicates_file |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
is.na(cv_percent) ~ 3,
cv_percent== min(cv_percent, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::ungroup()
temp <- Duplicates_file |>
dplyr::mutate(cv_percent_temp = dplyr::case_when(is.na(cv_percent) ~ 100000,
TRUE ~ cv_percent)) |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent_temp== min(cv_percent_temp, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::mutate(Retain, factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV")))
temp <- Duplicates_file |>
dplyr::mutate(cv_percent_temp = dplyr::case_when(is.na(cv_percent) ~ 100000,
TRUE ~ cv_percent)) |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent_temp== min(cv_percent_temp, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
#dplyr::mutate(Retain, factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV")))
dplyr::ungroup()
check <- subset(temp, Retain!=0)
check <- check[order(check$HMDB_ID),]
View(check)
table(temp$Retain)
temp <- Duplicates_file |>
dplyr::mutate(cv_percent_temp = dplyr::case_when(is.na(cv_percent) ~ 100000,
TRUE ~ cv_percent)) |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent_temp== min(cv_percent_temp, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::mutate(Retain = factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV")))
temp <- Duplicates_file |>
dplyr::mutate(cv_percent_temp = dplyr::case_when(is.na(cv_percent) ~ 100000,
TRUE ~ cv_percent)) |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent_temp== min(cv_percent_temp, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::ungroup() |>
dplyr::mutate(Retain = factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV"))) |>
dplyr::select(-cv_percent_temp)
check <- subset(temp, Retain!=0)
check <- check[order(check$HMDB_ID),]
View(check)
table(temp$Retain)
Duplicates_file <- Mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(Metabolite_CV_and_missingness |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID)) |>
dplyr::mutate(Metabolite = dplyr::case_when(Assay=="Amide" & HMDB_ID=="HMDB0000122" ~ "Amide_Hexose",
TRUE ~ Metabolite)) |>
dplyr::mutate(cv_percent_temp = dplyr::case_when(is.na(cv_percent) ~ 100000,
TRUE ~ cv_percent)) |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent_temp== min(cv_percent_temp, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::ungroup() |>
dplyr::mutate(Retain = factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV"))) |>
dplyr::select(-cv_percent_temp)
table(Duplicates_file$Retain)
tar_load(Metabolite_CV_and_missingness)
View(Metabolite_CV_and_missingness)
tar_make()
tar_make()
tar_make()
Duplicates_file <- mapping_file |>
dplyr::select(Metabolite, Original_Metabolite_Name, HMDB_ID) |>
dplyr::full_join(QC_file |>
dplyr::select(Metabolite, cv_percent, Assay), dplyr::join_by(Metabolite)) |>
dplyr::mutate(HMDB_ID = dplyr::case_when(Assay=="Amide" & Original_Metabolite_Name=="Glutamic acid" ~ "HMDB0000148",
TRUE ~ HMDB_ID)) |>
dplyr::mutate(Metabolite = dplyr::case_when(Assay=="Amide" & HMDB_ID=="HMDB0000122" ~ "Amide_Hexose",
TRUE ~ Metabolite)) |>
dplyr::mutate(cv_percent_temp = dplyr::case_when(is.na(cv_percent) ~ 100000,
TRUE ~ cv_percent)) |>
dplyr::group_by(HMDB_ID) |>
dplyr::mutate(Retain = dplyr::case_when(is.na(HMDB_ID) | HMDB_ID=="" ~ 0,
n() == 1 ~ 0,
cv_percent_temp== min(cv_percent_temp, na.rm = TRUE) ~ 1,
HMDB_ID=="internal standard" ~ 2,
# unique HMDB_ID      # lowest CV among duplicates
TRUE ~ 3 ) )  |>
dplyr::ungroup() |>
dplyr::mutate(Retain = factor(Retain, labels=c("Unique or missing HMDB ID", "Duplicated HMDB ID with lowest CV", "Internal standard", "Duplicated HMDB_ID and not lowest CV"))) |>
dplyr::select(-cv_percent_temp)
tar_make()
tar_make()
tar_load(Duplicates_flag_file)
View(Duplicates_flag_file)
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
View(Duplicates_flag_file)
table(Duplicates_flag_file$Retain)
duplicate_flagging_file <- tar_load(Duplicates_flag_file)
metabolite_file <- tar_load(Metabs_long)
keep_metabs <- subset(duplicate_flagging_file, Retain== "Unique or missing HMDB ID" | Retain== "Duplicated HMDB ID with lowest CV")
names(duplicate_flagging_file)
View(Duplicates_flag_file)
duplicate_flagging_file <- tar_load(Duplicates_flag_file)
tar_load(Duplicates_flag_file)
duplicate_flagging_file <- Duplicates_flag_file
metabolite_file <- Metabs_long
keep_metabs <- subset(duplicate_flagging_file, Retain== "Unique or missing HMDB ID" | Retain== "Duplicated HMDB ID with lowest CV")
metabolite_file_nodupes <- metabolite_file[,metabolite_file$Metbaolite %in% keep_metabs]
keep_metabs <- subset(duplicate_flagging_file, Retain== "Unique or missing HMDB ID" | Retain== "Duplicated HMDB ID with lowest CV")
metabolite_file_nodupes <- metabolite_file[,names(metabolite_file)=="exam" | names(metabolite_file) %in% keep_metabs]
metabolite_file_nodupes
keep_metabs <- subset(duplicate_flagging_file, Retain== "Unique or missing HMDB ID" | Retain== "Duplicated HMDB ID with lowest CV")
View(keep_metabs)
metabolite_file_nodupes <- metabolite_file[,names(metabolite_file)=="exam" | names(metabolite_file) %in% keep_metabs$Metabolite]
View(metabolite_file_nodupes)
keep_metabs <- subset(duplicate_flagging_file, Retain== "Unique or missing HMDB ID" | Retain== "Duplicated HMDB ID with lowest CV")
metabolite_file_nodupes <- metabolite_file[,names(metabolite_file)=="sidno" |
names(metabolite_file)=="idno" |
names(metabolite_file)=="TOM_ID" |
names(metabolite_file)=="subject_id" |
names(metabolite_file)=="exam" | names(metabolite_file) %in% keep_metabs$Metabolite]
tar_make()
tar_make()
tar_load(Final_metabs_long)
View(Final_metabs_long)
tar_make()
tar_make()
tar_make()
